<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaunchTRAC - Desktop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.8/dist/superhero/bootstrap.min.css">
    <style>
        /* ===== CSS Variables ===== */
        :root {
            /* Win98 Theme (Default) */
            --win98-bg: #008080;
            --win98-taskbar: #c0c0c0;
            --win98-border: #000000;
            --win98-window: #c0c0c0;
            --win98-titlebar: linear-gradient(90deg, #000080, #1084d0);
            --win98-text: #000000;
            --win98-button: #c0c0c0;
            --win98-shadow: #808080;
            --win98-highlight: #ffffff;
            
            /* WinXP Theme */
            --winxp-bg: #5a8db3;
            --winxp-taskbar: linear-gradient(180deg, #245edb, #3f8cf3);
            --winxp-window: #ece9d8;
            --winxp-titlebar: linear-gradient(180deg, #0054e3, #3a9ff5);
            --winxp-text: #000000;
            --winxp-button: #ece9d8;
            
            /* Vista/Win7 Theme */
            --win7-bg: #3a6ea5;
            --win7-taskbar: rgba(0, 0, 0, 0.75);
            --win7-window: #f0f0f0;
            --win7-titlebar: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            --win7-text: #000000;
            --win7-button: #ffffff;
            --win7-glass: rgba(255, 255, 255, 0.25);
            
            /* Win10 Theme */
            --win10-bg: #0078d7;
            --win10-taskbar: rgba(0, 0, 0, 0.95);
            --win10-window: #ffffff;
            --win10-titlebar: #ffffff;
            --win10-text: #000000;
            --win10-accent: #0078d7;
            
            /* Mdown gradient theme integration */
            --mdown-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* ===== Base Reset ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            font-family: 'MS Sans Serif', 'Segoe UI', Tahoma, sans-serif;
        }

        /* ===== Desktop Backgrounds ===== */
        body {
            background: var(--win98-bg);
            position: relative;
            cursor: default;
        }

        body.win98 {
            background: var(--win98-bg);
        }

        body.winxp {
            background: var(--winxp-bg) url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><circle cx="150" cy="250" r="200" fill="%23ffffff" opacity="0.1"/></svg>') no-repeat center;
            background-size: cover;
        }

        body.win7, body.vista {
            background: var(--win7-bg) var(--mdown-gradient);
            backdrop-filter: blur(20px);
        }

        body.win10 {
            background: var(--win10-bg);
        }

        /* ===== Desktop Icons Area ===== */
        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            gap: 30px;
            max-height: calc(100vh - 120px);
            z-index: 1;
        }

        .desktop-icon {
            width: 90px;
            text-align: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s ease;
            user-select: none;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .desktop-icon:active {
            background: rgba(255, 255, 255, 0.35);
        }

        .desktop-icon i {
            font-size: 48px;
            margin-bottom: 5px;
            display: block;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.5));
        }

        .desktop-icon span {
            font-size: 12px;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            display: block;
            word-wrap: break-word;
        }

        /* Win98 Icon Styling */
        .win98 .desktop-icon i {
            color: #ffffff;
        }

        .win98 .desktop-icon {
            border: 1px solid transparent;
        }

        .win98 .desktop-icon:focus,
        .win98 .desktop-icon.selected {
            background: rgba(0, 0, 128, 0.5);
            border: 1px dotted #ffffff;
        }

        /* ===== Taskbar ===== */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 4px;
            z-index: 1000;
            border-top: 2px solid;
        }

        /* Win98 Taskbar */
        .win98 .taskbar {
            background: var(--win98-taskbar);
            border-top-color: var(--win98-highlight);
        }

        .win98 .start-button {
            background: var(--win98-button);
            border: 2px outset var(--win98-highlight);
            color: var(--win98-text);
            font-weight: bold;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            height: 32px;
        }

        .win98 .start-button:active {
            border-style: inset;
        }

        .win98 .start-button img {
            width: 20px;
            height: 20px;
        }

        /* WinXP Taskbar */
        .winxp .taskbar {
            background: var(--winxp-taskbar);
            border-top-color: #4a8dd3;
            border-radius: 0;
        }

        .winxp .start-button {
            background: linear-gradient(180deg, #5ecd5e, #3ba03b);
            border: 1px solid #2d7a2d;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            height: 32px;
            box-shadow: inset 0 1px rgba(255,255,255,0.3);
        }

        /* Win7 Taskbar */
        .win7 .taskbar, .vista .taskbar {
            background: var(--win7-taskbar);
            backdrop-filter: blur(20px);
            border-top-color: rgba(255, 255, 255, 0.2);
        }

        .win7 .start-button, .vista .start-button {
            background: transparent;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s ease;
            border-radius: 4px;
        }

        .win7 .start-button:hover, .vista .start-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .win7 .start-button i, .vista .start-button i {
            font-size: 24px;
            color: #ffffff;
        }

        /* Win10 Taskbar */
        .win10 .taskbar {
            background: var(--win10-taskbar);
            border-top-color: rgba(255, 255, 255, 0.1);
            justify-content: center;
        }

        .win10 .start-button {
            background: transparent;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .win10 .start-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .win10 .start-button i {
            font-size: 20px;
            color: #ffffff;
        }

        /* ===== Start Menu ===== */
        .start-menu {
            position: fixed;
            bottom: 45px;
            left: 5px;
            width: 250px;
            background: var(--win98-window);
            border: 2px outset var(--win98-highlight);
            display: none;
            flex-direction: column;
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .start-menu.open {
            display: flex;
        }

        /* Win98 Start Menu */
        .win98 .start-menu {
            background: var(--win98-window);
        }

        .win98 .start-menu-header {
            background: var(--win98-titlebar);
            color: white;
            padding: 10px;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            width: 40px;
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
        }

        .win98 .start-menu-items {
            margin-left: 40px;
            padding: 5px;
        }

        /* WinXP Start Menu */
        .winxp .start-menu {
            background: linear-gradient(to right, #245edb 40px, #fff 40px);
            border: 1px solid #4a8dd3;
            border-radius: 8px 8px 0 0;
        }

        .winxp .start-menu-header {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 40px;
            background: linear-gradient(180deg, #4a8dd3, #245edb);
            color: white;
            display: flex;
            align-items: flex-end;
            padding: 10px 5px;
            font-weight: bold;
            writing-mode: vertical-rl;
        }

        .winxp .start-menu-items {
            margin-left: 45px;
            padding: 10px 5px;
        }

        /* Win7 Start Menu */
        .win7 .start-menu, .vista .start-menu {
            background: rgba(240, 240, 240, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px 8px 0 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .win7 .start-menu-items, .vista .start-menu-items {
            padding: 10px;
        }

        /* Win10 Start Menu */
        .win10 .start-menu {
            width: 600px;
            height: 500px;
            background: rgba(30, 30, 30, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0;
            bottom: 45px;
            left: 50%;
            transform: translateX(-50%);
        }

        .win10 .start-menu-items {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        /* Start Menu Items */
        .start-menu-item {
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .start-menu-item:hover {
            background: rgba(0, 0, 255, 0.1);
        }

        .win98 .start-menu-item:hover {
            background: #000080;
            color: white;
        }

        .winxp .start-menu-item:hover {
            background: #d1e8ff;
        }

        .win7 .start-menu-item:hover, .vista .start-menu-item:hover {
            background: rgba(0, 120, 215, 0.2);
        }

        .win10 .start-menu-item {
            background: var(--win10-accent);
            color: white;
            padding: 40px 20px;
            text-align: center;
            flex-direction: column;
            gap: 5px;
        }

        .win10 .start-menu-item:hover {
            background: #005a9e;
        }

        .start-menu-item i {
            font-size: 18px;
        }

        .win10 .start-menu-item i {
            font-size: 32px;
        }

        /* ===== System Tray ===== */
        .system-tray {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 8px;
            height: 100%;
        }

        .system-tray-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .system-tray-icon:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .system-tray-icon i {
            font-size: 14px;
            color: white;
        }

        .win98 .system-tray {
            border-left: 2px solid var(--win98-shadow);
            border-right: 2px solid var(--win98-highlight);
        }

        .win98 .system-tray-icon i {
            color: var(--win98-text);
        }

        .clock {
            font-size: 12px;
            color: white;
            padding: 4px 8px;
            font-family: 'Segoe UI', sans-serif;
        }

        .win98 .clock {
            color: var(--win98-text);
            border: 2px inset var(--win98-highlight);
            background: var(--win98-window);
        }

        /* ===== Window ===== */
        .window {
            position: fixed;
            width: 80%;
            height: 80%;
            max-width: 1200px;
            max-height: 800px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            display: none;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 100;
            overflow: hidden;
        }

        .window.open {
            display: flex;
        }

        /* Win98 Window */
        .win98 .window {
            background: var(--win98-window);
            border: 2px outset var(--win98-highlight);
        }

        .win98 .window-titlebar {
            background: var(--win98-titlebar);
            color: white;
            padding: 4px 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            font-size: 14px;
        }

        .win98 .window-controls button {
            width: 20px;
            height: 20px;
            background: var(--win98-button);
            border: 2px outset var(--win98-highlight);
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 2px;
        }

        .win98 .window-controls button:active {
            border-style: inset;
        }

        /* WinXP Window */
        .winxp .window {
            background: var(--winxp-window);
            border: 1px solid #4a8dd3;
            border-radius: 8px 8px 0 0;
        }

        .winxp .window-titlebar {
            background: var(--winxp-titlebar);
            color: white;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
        }

        .winxp .window-controls button {
            width: 24px;
            height: 24px;
            background: #fff;
            border: 1px solid #0054e3;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 4px;
            color: #0054e3;
        }

        /* Win7 Window */
        .win7 .window, .vista .window {
            background: var(--win7-window);
            border: 1px solid rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.6);
        }

        .win7 .window-titlebar, .vista .window-titlebar {
            background: var(--win7-titlebar);
            backdrop-filter: blur(20px);
            color: var(--win7-text);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
        }

        .win7 .window-controls button, .vista .window-controls button {
            width: 28px;
            height: 28px;
            background: transparent;
            border: none;
            cursor: pointer;
            margin-left: 4px;
            color: #333;
            transition: background 0.2s ease;
            border-radius: 4px;
        }

        .win7 .window-controls button:hover, .vista .window-controls button:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        /* Win10 Window */
        .win10 .window {
            background: var(--win10-window);
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 0;
        }

        .win10 .window-titlebar {
            background: var(--win10-titlebar);
            color: var(--win10-text);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 400;
        }

        .win10 .window-controls button {
            width: 46px;
            height: 32px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: #000;
            transition: background 0.15s ease;
        }

        .win10 .window-controls button:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .win10 .window-controls button.close:hover {
            background: #e81123;
            color: white;
        }

        /* Window Controls */
        .window-titlebar {
            user-select: none;
            cursor: move;
        }

        .window-controls {
            display: flex;
            align-items: center;
        }

        /* Window Content */
        .window-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .window-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ===== Theme Selector (Settings) ===== */
        .theme-selector {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1001;
            min-width: 400px;
        }

        .theme-selector.open {
            display: block;
        }

        .theme-selector h2 {
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .theme-button {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
        }

        .theme-button:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
        }

        .theme-button.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .theme-button i {
            font-size: 24px;
        }

        .close-theme-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-theme-selector:hover {
            color: #333;
        }

        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .desktop-icons {
                gap: 20px;
                max-height: calc(100vh - 100px);
            }
            
            .desktop-icon {
                width: 70px;
            }
            
            .desktop-icon i {
                font-size: 36px;
            }
            
            .start-menu {
                width: 200px;
            }
            
            .win10 .start-menu {
                width: 90%;
                height: 60%;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .window {
                width: 95%;
                height: 90%;
            }

            .theme-selector {
                width: 90%;
                min-width: 300px;
            }
        }

        /* ===== Loading Animation ===== */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .loading.show {
            display: flex;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="win98">
    <!-- Desktop Icons -->
    <div class="desktop-icons">
        <!-- AI Hub Tool -->
        <div class="desktop-icon" data-app="aihub/index.html" tabindex="0">
            <i class="fas fa-robot"></i>
            <span>AI Hub</span>
        </div>

        <!-- Mdown Tool -->
        <div class="desktop-icon" data-app="mdown/renderer.html" tabindex="0">
            <i class="fas fa-file-code"></i>
            <span>Mdown</span>
        </div>

        <!-- Settings -->
        <div class="desktop-icon" id="settings-icon" tabindex="0">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>

        <!-- About -->
        <div class="desktop-icon" id="about-icon" tabindex="0">
            <i class="fas fa-info-circle"></i>
            <span>About</span>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <button class="start-button" id="start-button">
            <i class="fab fa-windows"></i>
            <span>Start</span>
        </button>

        <div class="system-tray">
            <div class="system-tray-icon" title="Volume">
                <i class="fas fa-volume-up"></i>
            </div>
            <div class="system-tray-icon" title="Network">
                <i class="fas fa-wifi"></i>
            </div>
            <div class="clock" id="clock">12:00 PM</div>
        </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="start-menu">
        <div class="start-menu-header">LaunchTRAC</div>
        <div class="start-menu-items">
            <div class="start-menu-item" data-app="aihub/index.html">
                <i class="fas fa-robot"></i>
                <span>AI Hub</span>
            </div>
            <div class="start-menu-item" data-app="mdown/renderer.html">
                <i class="fas fa-file-code"></i>
                <span>Mdown</span>
            </div>
            <div class="start-menu-item" id="settings-menu-item">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
            <div class="start-menu-item" id="about-menu-item">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
            </div>
        </div>
    </div>

    <!-- Application Window -->
    <div class="window" id="app-window">
        <div class="window-titlebar" id="window-titlebar">
            <span id="window-title">Application</span>
            <div class="window-controls">
                <button class="minimize" title="Minimize">
                    <i class="fas fa-window-minimize"></i>
                </button>
                <button class="maximize" title="Maximize">
                    <i class="far fa-window-maximize"></i>
                </button>
                <button class="close" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="window-content">
            <iframe id="app-iframe" src=""></iframe>
        </div>
    </div>

    <!-- Theme Selector -->
    <div class="theme-selector" id="theme-selector">
        <button class="close-theme-selector" id="close-theme-selector">&times;</button>
        <h2>
            <i class="fas fa-palette"></i>
            Theme Settings
        </h2>
        <div class="theme-buttons">
            <button class="theme-button active" data-theme="win98">
                <i class="fab fa-windows"></i>
                Windows 98
            </button>
            <button class="theme-button" data-theme="winxp">
                <i class="fab fa-windows"></i>
                Windows XP
            </button>
            <button class="theme-button" data-theme="vista">
                <i class="fab fa-windows"></i>
                Windows Vista
            </button>
            <button class="theme-button" data-theme="win7">
                <i class="fab fa-windows"></i>
                Windows 7
            </button>
            <button class="theme-button" data-theme="win10">
                <i class="fab fa-windows"></i>
                Windows 10
            </button>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <script>
        /**
         * LaunchTRAC Desktop Application
         * Windows-themed launcher for HTML applications
         * Supports Win98, WinXP, Vista, Win7, and Win10 themes
         */

        // ===== Configuration =====
        const CONFIG = {
            defaultTheme: 'win98',
            storageKey: 'launchtrac-theme',
            clockUpdateInterval: 1000,
            doubleClickDelay: 300
        };

        // ===== DOM Elements =====
        const elements = {
            body: document.body,
            startButton: document.getElementById('start-button'),
            startMenu: document.getElementById('start-menu'),
            appWindow: document.getElementById('app-window'),
            appIframe: document.getElementById('app-iframe'),
            windowTitle: document.getElementById('window-title'),
            windowTitlebar: document.getElementById('window-titlebar'),
            themeSelector: document.getElementById('theme-selector'),
            closeThemeSelector: document.getElementById('close-theme-selector'),
            clock: document.getElementById('clock'),
            loading: document.getElementById('loading'),
            desktopIcons: document.querySelectorAll('.desktop-icon[data-app]'),
            startMenuItems: document.querySelectorAll('.start-menu-item[data-app]'),
            settingsIcon: document.getElementById('settings-icon'),
            settingsMenuItem: document.getElementById('settings-menu-item'),
            aboutIcon: document.getElementById('about-icon'),
            aboutMenuItem: document.getElementById('about-menu-item'),
            themeButtons: document.querySelectorAll('.theme-button'),
            windowClose: document.querySelector('.window-controls .close'),
            windowMinimize: document.querySelector('.window-controls .minimize'),
            windowMaximize: document.querySelector('.window-controls .maximize')
        };

        // ===== State Management =====
        const state = {
            currentTheme: CONFIG.defaultTheme,
            isStartMenuOpen: false,
            isThemeSelectorOpen: false,
            isWindowOpen: false,
            isWindowMaximized: false,
            currentApp: null,
            lastClickTime: 0,
            lastClickedIcon: null
        };

        // ===== Clock Update =====
        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            
            elements.clock.textContent = `${displayHours}:${minutes} ${ampm}`;
        }

        // ===== Theme Management =====
        function loadTheme() {
            const savedTheme = localStorage.getItem(CONFIG.storageKey);
            if (savedTheme) {
                applyTheme(savedTheme);
            }
        }

        function applyTheme(theme) {
            // Remove all theme classes
            elements.body.classList.remove('win98', 'winxp', 'vista', 'win7', 'win10');
            
            // Add new theme class
            elements.body.classList.add(theme);
            
            // Update state
            state.currentTheme = theme;
            
            // Save to localStorage
            localStorage.setItem(CONFIG.storageKey, theme);
            
            // Update active button
            elements.themeButtons.forEach(btn => {
                if (btn.dataset.theme === theme) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            console.log(`Theme changed to: ${theme}`);
        }

        // ===== Start Menu Toggle =====
        function toggleStartMenu() {
            state.isStartMenuOpen = !state.isStartMenuOpen;
            
            if (state.isStartMenuOpen) {
                elements.startMenu.classList.add('open');
            } else {
                elements.startMenu.classList.remove('open');
            }
        }

        function closeStartMenu() {
            state.isStartMenuOpen = false;
            elements.startMenu.classList.remove('open');
        }

        // ===== Window Management =====
        function openApp(appPath, appName) {
            // Show loading
            showLoading();

            // Close start menu
            closeStartMenu();

            // Set window title
            elements.windowTitle.textContent = appName;

            // Set iframe source
            elements.appIframe.src = appPath;

            // Wait for iframe to load
            elements.appIframe.onload = () => {
                hideLoading();
                
                // Show window
                elements.appWindow.classList.add('open');
                state.isWindowOpen = true;
                state.currentApp = { path: appPath, name: appName };

                console.log(`Opened app: ${appName} (${appPath})`);
            };

            // Handle iframe errors
            elements.appIframe.onerror = () => {
                hideLoading();
                alert(`Failed to load ${appName}. Please check if the file exists.`);
            };
        }

        function closeWindow() {
            elements.appWindow.classList.remove('open');
            state.isWindowOpen = false;
            state.isWindowMaximized = false;
            state.currentApp = null;
            
            // Clear iframe
            elements.appIframe.src = '';
        }

        function minimizeWindow() {
            elements.appWindow.classList.remove('open');
            // Window stays in state for taskbar restoration
        }

        function maximizeWindow() {
            state.isWindowMaximized = !state.isWindowMaximized;
            
            if (state.isWindowMaximized) {
                elements.appWindow.style.width = '100%';
                elements.appWindow.style.height = 'calc(100% - 40px)';
                elements.appWindow.style.top = '0';
                elements.appWindow.style.left = '0';
                elements.appWindow.style.transform = 'none';
            } else {
                elements.appWindow.style.width = '80%';
                elements.appWindow.style.height = '80%';
                elements.appWindow.style.top = '50%';
                elements.appWindow.style.left = '50%';
                elements.appWindow.style.transform = 'translate(-50%, -50%)';
            }
        }

        // ===== Theme Selector =====
        function openThemeSelector() {
            elements.themeSelector.classList.add('open');
            state.isThemeSelectorOpen = true;
            closeStartMenu();
        }

        function closeThemeSelector() {
            elements.themeSelector.classList.remove('open');
            state.isThemeSelectorOpen = false;
        }

        // ===== Loading Indicator =====
        function showLoading() {
            elements.loading.classList.add('show');
        }

        function hideLoading() {
            elements.loading.classList.remove('show');
        }

        // ===== About Dialog =====
        function showAbout() {
            const aboutMessage = `LaunchTRAC Desktop v1.0

A Windows-themed launcher for HTML applications.

Features:
• Multiple Windows themes (98, XP, Vista, 7, 10)
• Launch HTML tools and apps
• Integrated with Mdown gradient theme
• Built with vanilla HTML/CSS/JS

Powered by Bootswatch v5.3.8
Created with ❤️ for productivity`;

            alert(aboutMessage);
            closeStartMenu();
        }

        // ===== Double Click Handler =====
        function handleIconClick(icon) {
            const currentTime = Date.now();
            const timeDiff = currentTime - state.lastClickTime;

            if (icon === state.lastClickedIcon && timeDiff < CONFIG.doubleClickDelay) {
                // Double click detected
                const appPath = icon.dataset.app;
                const appName = icon.querySelector('span').textContent;
                openApp(appPath, appName);
                
                // Reset
                state.lastClickTime = 0;
                state.lastClickedIcon = null;
            } else {
                // Single click - select icon
                document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
                icon.classList.add('selected');
                
                // Store for double-click detection
                state.lastClickTime = currentTime;
                state.lastClickedIcon = icon;
            }
        }

        // ===== Event Listeners =====
        function setupEventListeners() {
            // Start button
            elements.startButton.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleStartMenu();
            });

            // Desktop icons (double-click to open)
            elements.desktopIcons.forEach(icon => {
                icon.addEventListener('click', () => handleIconClick(icon));
                icon.addEventListener('dblclick', () => {
                    const appPath = icon.dataset.app;
                    const appName = icon.querySelector('span').textContent;
                    openApp(appPath, appName);
                });
                
                // Keyboard support
                icon.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        const appPath = icon.dataset.app;
                        const appName = icon.querySelector('span').textContent;
                        openApp(appPath, appName);
                    }
                });
            });

            // Start menu items (single-click to open)
            elements.startMenuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const appPath = item.dataset.app;
                    const appName = item.querySelector('span').textContent;
                    openApp(appPath, appName);
                });
            });

            // Settings
            elements.settingsIcon.addEventListener('click', () => handleIconClick(elements.settingsIcon));
            elements.settingsIcon.addEventListener('dblclick', openThemeSelector);
            elements.settingsIcon.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') openThemeSelector();
            });
            elements.settingsMenuItem.addEventListener('click', openThemeSelector);

            // About
            elements.aboutIcon.addEventListener('click', () => handleIconClick(elements.aboutIcon));
            elements.aboutIcon.addEventListener('dblclick', showAbout);
            elements.aboutIcon.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') showAbout();
            });
            elements.aboutMenuItem.addEventListener('click', showAbout);

            // Theme buttons
            elements.themeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    applyTheme(theme);
                });
            });

            // Theme selector close
            elements.closeThemeSelector.addEventListener('click', closeThemeSelector);

            // Window controls
            elements.windowClose.addEventListener('click', closeWindow);
            elements.windowMinimize.addEventListener('click', minimizeWindow);
            elements.windowMaximize.addEventListener('click', maximizeWindow);

            // Close menus on outside click
            document.addEventListener('click', (e) => {
                if (!elements.startMenu.contains(e.target) && !elements.startButton.contains(e.target)) {
                    closeStartMenu();
                }
                
                if (!elements.themeSelector.contains(e.target)) {
                    closeThemeSelector();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Escape closes everything
                if (e.key === 'Escape') {
                    closeStartMenu();
                    closeThemeSelector();
                    if (state.isWindowOpen) closeWindow();
                }
                
                // Windows key opens start menu
                if (e.key === 'Meta' || e.key === 'OS') {
                    e.preventDefault();
                    toggleStartMenu();
                }
            });

            // Window dragging (simplified)
            let isDragging = false;
            let dragStartX, dragStartY, windowStartX, windowStartY;

            elements.windowTitlebar.addEventListener('mousedown', (e) => {
                if (e.target.closest('.window-controls')) return;
                if (state.isWindowMaximized) return;
                
                isDragging = true;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                
                const rect = elements.appWindow.getBoundingClientRect();
                windowStartX = rect.left;
                windowStartY = rect.top;
                
                elements.appWindow.style.transform = 'none';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const deltaX = e.clientX - dragStartX;
                const deltaY = e.clientY - dragStartY;
                
                elements.appWindow.style.left = `${windowStartX + deltaX}px`;
                elements.appWindow.style.top = `${windowStartY + deltaY}px`;
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }

        // ===== Initialization =====
        function init() {
            console.log('LaunchTRAC Desktop initializing...');
            
            // Load saved theme
            loadTheme();
            
            // Start clock
            updateClock();
            setInterval(updateClock, CONFIG.clockUpdateInterval);
            
            // Setup event listeners
            setupEventListeners();
            
            console.log('LaunchTRAC Desktop initialized successfully!');
        }

        // Start application when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
